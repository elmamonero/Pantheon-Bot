let handler = async (m, { conn, participants, command }) => {
  if (!m.isGroup) return conn.reply(m.chat, 'Este comando solo funciona en grupos.', m);

  if (command === 'totalmensajes') {
    let usuariosMensajes = participants.map(user => ({
      id: user.id,
      mensajes: (global.db.data.users[user.id]?.chat) || 0
    }));

    usuariosMensajes.sort((a, b) => b.mensajes - a.mensajes);

    let texto = `ğŸ“Š *Total de Mensajes por Usuario* ğŸ“Š\n\n`;
    texto += usuariosMensajes.map((u, i) => `${i + 1}. @${u.id.split('@')[0]} - *${u.mensajes}* mensajes`).join('\n');

    await conn.reply(m.chat, texto, m, { mentions: usuariosMensajes.map(u => u.id) });
  } else if (command === 'resetmensaje') {
    participants.forEach(user => {
      if (!global.db.data.users[user.id]) global.db.data.users[user.id] = {};
      global.db.data.users[user.id].chat = 0;
    });
    await conn.reply(m.chat, 'âœ… Conteo de mensajes reiniciado para todos los participantes.', m);
  }
};

handler.help = ['totalmensajes', 'resetmensaje'];
handler.tags = ['group'];
handler.command = /^(totalmensajes|resetmensaje)$/i;
handler.admin = true;
handler.botAdmin = true;

export default handler;
